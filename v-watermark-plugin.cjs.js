'use strict';const t=-25,n="14px",e="\u5fae\u8f6f\u96c5\u9ed1",o="normal",i="normal",r="#c9c9c9",l="center",a="middle",c=285,s=400,u=.4,d=9999,v={id:"v-watermark-element",canvas:document.createElement('canvas'),options:{text:[]},t:new MutationObserver((()=>{}))};function h(){return{size:v.options.fontSize||n,family:v.options.fontFamily||e,weight:v.options.fontWeight||o,style:v.options.fontStyle||i}}function m(){var e,o,i;const u=(null!==(e=v.options.rotate)&&void 0!==e?e:t)*Math.PI/180,d=h(),[m,M]=(()=>{const t=v.canvas.getContext("2d");if(!t)return[0,0];t.font=`${d.style} ${d.weight} ${d.size} ${d.family}`;const n=parseInt(d.size);return v.options.text.reduce((([e,o],i)=>{const r=t.measureText(i);return[Math.max(e,r.width),Math.max(o,1.2*n)]}),[0,0])})(),f=Math.cos(u),b=Math.sin(u),p=Math.abs(m*f)+Math.abs(M*b),$=Math.abs(m*b)+Math.abs(M*f),[g,w]=[null!==(o=v.options.o)&&void 0!==o?o:c,null!==(i=v.options.i)&&void 0!==i?i:s];Object.assign(v.canvas,{width:Math.max(2*p,g),height:Math.max(2*$,w)}),[!0,!1].forEach((e=>{!function(e){var o;const i=v.canvas.getContext("2d"),c=null!==(o=v.options.rotate)&&void 0!==o?o:t,s=c*Math.PI/180,{width:u,height:d}=i.canvas,[m,M]=e?[u/4,d/7]:[.75*u,.64*d];i.resetTransform(),i.translate(m,M),i.rotate(s);const f=h();Object.assign(i,{font:`${f.style} ${f.weight} ${f.size} ${f.family}`,fillStyle:v.options.color||r,textAlign:v.options.textAlign||l,textBaseline:v.options.textBaseline||a});const b=1.2*parseInt(v.options.fontSize||n);v.options.text.forEach(((t,n)=>{const e=n*b;i.fillText(t,0,e)}))}(e)}))}function M(){var t,n;if(document.getElementById(v.id))return;const e=document.createElement("div");e.id=v.id,e.style.pointerEvents="none",e.style.position="fixed",e.style.inset="0",e.style.opacity=String(null!==(t=v.options.opacity)&&void 0!==t?t:u),e.style.zIndex=String(null!==(n=v.options.zIndex)&&void 0!==n?n:d),e.style.background=`url(${v.canvas.toDataURL('image/webp',.8)}) left top repeat`,document.body.appendChild(e),f()}const f=()=>{const t=document.getElementById(v.id),n=t.parentNode;v.t=new MutationObserver((e=>{for(const o of e)'childList'!==o.type||n.contains(t)?'attributes'===o.type&&'style'===o.attributeName&&(v.t.disconnect(),t.remove(),M()):(v.t.disconnect(),M())})),v.t.observe(n,{childList:!0}),v.t.observe(t,{attributes:!0,attributeFilter:['style'],subtree:!0})},b=()=>{const t=document.getElementById(v.id);t&&(v.t.disconnect(),document.body.removeChild(t))};exports.createWaterMark=t=>{(t=>{var n;Array.isArray(null==t?void 0:t.text)&&0!==(null===(n=null==t?void 0:t.text)||void 0===n?void 0:n.length)&&!t.text.some((t=>!(null==t?void 0:t.trim())))&&(b(),v.options=t,m(),M())})(t)},exports.removeWatermark=b;
